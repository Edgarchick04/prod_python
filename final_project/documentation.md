# Документация проекта (название бота пока под вопросом)

### Режим 1: Самостоятельная прогулка

Пользователь выбирает параметры прогулки (тип активности, настроение, длительность, размер группы). После запуска режима 
бот присылает пользователю задания по заданным параметрам по его требованию. Пользователь может отказаться 
от задания и перегенерировать его

Примеры заданий:

* «Сделай фото чего-то синего рядом»
* «Найди объект круглой формы и сфотографируй»
* «Зайди во двор, который ты никогда не посещал»

### Режим 2: Генерация маршрута

Система формирует **маршрут прогулки** на основе параметров, введенных пользователем (настроение, тип активности, 
длительность прогулки)

Маршрут создаётся на основе **отправной точки пользователя**. 

Пользователь может **перегенерировать маршрут**, если он ему не понравился. 

После генерации маршрута пользователь выполняет задания последовательно, двигаясь по предложенному пути.


## 2. Что будет видеть пользователь

Пользователь взаимодействует с ботом через Telegram. Он увидит:

* Приветственное сообщение
* Меню выбора "начало прогулки", "статистика"
* Далее пользователь выбирает параметры прогулки
* Меню выбора режима: Самостоятельная прогулка или Генерация маршрута
* Для режима 1: возможность запроса задания по требованию и перегенерации его
* Для режима 2: параметры маршрута и возможность перегенерации, затем возможность запроса задания по требованию и затем перегенерации его
* Сгенерированный маршрут прогулки** (точки интереса + порядок посещения, если выбран режим 2)
* Генерируемые задания
* Запрос на отправку фото как подтверждения
* Статистику: Количество прогулок, проведенное в них время, количество выполненных заданий (по требованию)
* Историю выполненных заданий (по требованию пользователя)


## 3. Основные задачи проекта

### 3.1. Анализ требований (2 часа)

* Составить сценарии использования
* Определить параметры генерации заданий и маршрута

### 3.2. Проектирование архитектуры (2 часа)

* Определить взаимодействие модулей и поток данных между режимами

### 3.3. Разработка Telegram-бота (15 часов)

* Настройка Telegram API
* Реализация двух режимов
* Реализация логики генерации заданий и маршрутов
* Обработка фото и сохранение истории

### 3.4. Дополнительные улучшения (при необходимости) (4 часа)

* Система наград
* может быть что-нибудь еще в будущем

### 3.5. Тестирование (4 часа)

* Юнит-тесты
* Проверка корректности сценариев

## 4. Диаграммы системы (Mermaid)

### 4.1. Сценарии использования

```mermaid
flowchart TD
    A[Пользователь] -->|/start| B(Главное меню)
    B --> C{Выбор действия}

    C --> D1[Начать прогулку]
    C --> D2[Мои прогулки]

    D1 --> E1[Ввод настроек: время, настроение, активность, размер группы]flowchart TD
    A[Пользователь] -->|/start| B(Главное меню)
    B --> C{Выбор действия}

    C --> D1[Начать прогулку]
    C --> D2[Мои прогулки]

    D1 --> E1{Выбор режима}
    
    %% Режим 1: Самостоятельная прогулка
    E1 -->|Самостоятельная| F1[Запрос задания]
    F1 --> G1[GigaChat: Генерация одного задания]
    G1 --> H1[Активная прогулка]
    
    %% Режим 2: Генерация маршрута
    E1 -->|Маршрут ИИ| F2[Ввод настроек и локации]
    F2 --> G2[Overpass API: Поиск мест]
    G2 --> H2[GigaChat: Сборка JSON-маршрута]
    H2 --> H1
    
    %% Общий цикл для обоих режимов
    H1 --> I1{Действие на прогулке}
    I1 -->|Задание| F1
    I1 -->|Фото| J1[SQLAlchemy: Сохранение фото]
    I1 -->|Финиш| K1[SQLAlchemy: Запись итогов в БД]
    
    K1 --> L1[Вывод статистики прогулки]

    %% История
    D2 --> M1[История маршрутов / Статистика]
    M1 --> N1[Просмотр прошлых фото и точек]
    E1 --> E2[Отправка геолокации]
    E2 --> F1[Запрос к Overpass API: поиск мест]
    F1 --> G1[GigaChat: сборка маршрута]
    G1 --> H1[Активная прогулка: задания и фото]
    H1 --> I1[Завершение прогулки]
    I1 --> J1[SQLAlchemy: запись в БД]

    D2 --> K1[История маршрутов]
    D2 --> K2[Статистика пользователя]
    K1 --> L1[Просмотр фото из Postgres]
```

### 4.2. Sequence Diagram (пример режима 2)

```mermaid
sequenceDiagram
    participant U as Пользователь
    participant T as Бот (aiogram)
    participant G as RouteGenerator
    participant API as Overpass / GigaChat
    participant DB as PostgreSQL

    U->>T: Выбор режима и настроек
    U->>T: Отправка локации (lat, lon)
    T->>G: Запрос на генерацию
    G->>API: Поиск мест рядом (Overpass)
    API-->>G: Список точек
    G->>API: Запрос на JSON маршрута (GigaChat)
    API-->>G: JSON с заданиями
    G-->>T: Готовый маршрут
    T->>DB: start_walk (создание записи)
    T-->>U: Маршрут и первое задание
    U->>T: Фотоотчет
    T->>DB: add_task_photo (сохранение file_id)
    U->>T: Завершить прогулку
    T->>DB: finish_walk (обновление duration)
    DB-->>T: Итоги сохранены
    T-->>U: Статистика прогулки
```

### 4.3 DataBase

```mermaid
erDiagram
    WALKS {
        int id PK
        int user_id
        string date
        int duration
        int tasks_count
        string route
        string start_point
        string end_point
    }

    PHOTOS {
        int id PK
        int walk_id FK
        string file_id
    }

    WALKS ||--o{ PHOTOS : contains
```

## 5.1 Команда

### Dev1: Петросян Эдгар

Задачи:
* Регистрация бота
* Генерация заданий и маршрута
* Создание БД и сбор статистики

### Dev2: Хачунский Тимофей
Задачи:
* Создание основы бота (handlers, states)
* Написание тестов
* Создание Докера


